name: diradar
image: python:3.10-slim
build:
  context: .
  dockerfile_inline: |
    FROM python:3.10-slim
    
    # Install system dependencies
    RUN apt-get update && apt-get install -y \
        gcc \
        g++ \
        cmake \
        libglib2.0-0 \
        libsm6 \
        libxext6 \
        libxrender-dev \
        libgomp1 \
        wget \
        curl \
        git \
        && rm -rf /var/lib/apt/lists/*
    
    # Set working directory
    WORKDIR /workspace
    
    # Copy project files
    COPY . /workspace/
    
    # Make bootstrap script executable
    RUN chmod +x bootstrap.sh
    
    # Install Python dependencies
    RUN pip install --upgrade pip && \
        pip install -r requirements.txt
    
    # Expose Streamlit port
    EXPOSE 7860
    
    # Set environment variables
    ENV PYTHONUNBUFFERED=1
    ENV PYTHONDONTWRITEBYTECODE=1

ports:
  - port: 7860
    name: Streamlit App
    
env:
  - STREAMLIT_SERVER_PORT=7860
  - STREAMLIT_SERVER_HEADLESS=true
  - STREAMLIT_SERVER_ADDRESS=0.0.0.0

commands:
  start: ./bootstrap.sh
